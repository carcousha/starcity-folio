# تعليمات إصلاح قاعدة البيانات

## المشكلة
يظهر خطأ "Could not find the 'bio' column of 'enhanced_contacts' in the schema cache" عند محاولة إضافة جهة اتصال جديدة.

## السبب
جدول `enhanced_contacts` في قاعدة البيانات لا يحتوي على عدة أعمدة مطلوبة بواسطة التطبيق.

## الحل

### الخطوة 1: تنفيذ ملف SQL في Supabase

1. افتح لوحة تحكم Supabase الخاصة بمشروعك
2. انتقل إلى قسم "SQL Editor"
3. انسخ محتوى ملف `fix_enhanced_contacts_schema.sql` والصقه في المحرر
4. اضغط على "Run" لتنفيذ الأوامر

### الخطوة 2: التحقق من نجاح العملية

بعد تنفيذ ملف SQL، يجب أن ترى رسالة:
```
تم إضافة جميع الأعمدة المفقودة بنجاح إلى جدول enhanced_contacts
```

### الخطوة 3: إعادة تشغيل التطبيق

1. أوقف الخادم المحلي (Ctrl+C)
2. أعد تشغيله باستخدام `npm run dev`
3. جرب إضافة جهة اتصال جديدة للتأكد من الحل

## الأعمدة التي تم إضافتها

- `bio` - النبذة الشخصية
- `full_name` - الاسم الكامل
- `language` - اللغة المفضلة
- `rating_1_5` - التقييم من 1-5
- `status` - حالة جهة الاتصال
- `follow_up_status` - حالة المتابعة
- `priority` - الأولوية
- `preferred_contact_method` - طريقة الاتصال المفضلة
- `office_classification` - تصنيف المكتب
- `job_title` - المسمى الوظيفي
- `units_count` - عدد الوحدات
- `cr_number` - رقم السجل التجاري
- `cr_expiry_date` - تاريخ انتهاء السجل التجاري
- `nationality` - الجنسية
- `id_type` - نوع الهوية
- `id_number` - رقم الهوية
- `id_expiry_date` - تاريخ انتهاء الهوية
- `bank_name` - اسم البنك
- `account_number` - رقم الحساب
- `iban` - رقم الآيبان

## ملاحظات مهمة

1. تم تحديث ملف `types.ts` ليعكس التغييرات الجديدة
2. تم إضافة فهارس لتحسين الأداء
3. تم إضافة قيود للتحقق من صحة البيانات
4. تم تحديث دالة البحث النصي لتشمل الحقول الجديدة

## في حالة استمرار المشكلة

إذا استمر ظهور الخطأ بعد تنفيذ هذه الخطوات:

1. تأكد من تنفيذ جميع أوامر SQL بنجاح
2. تحقق من أن الأعمدة تم إضافتها فعلاً في جدول `enhanced_contacts`
3. أعد تشغيل التطبيق بالكامل
4. امسح cache المتصفح

## اختبار الحل

بعد تنفيذ الخطوات:

1. انتقل إلى صفحة جهات الاتصال
2. اضغط على "إضافة جهة اتصال جديدة"
3. املأ النموذج واضغط حفظ
4. يجب أن تتم العملية بنجاح دون أخطاء

إذا نجحت العملية، فقد تم حل المشكلة بالكامل.